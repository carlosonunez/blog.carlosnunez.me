---
title: "neurons are firing again! How I eat my own dogfood with my blog."
draft: true
date: 2019-02-06
slug: "neurons-are-firing-again"
image: "/images/neutrons-are-firing-again/header.jpg"
description: >-
  How I migrated from WordPress to Hugo on AWS and saved >$10/month in the
  process.
keywords:
  - aws
  - hugo
  - blog
  - eat-your-own-dogfood
  - terraform
  - provisioning
  - infrastructure
---

First, huge shout out to the five of you that actually read stuff from my
WordPress blog! You might have noticed that aside from 
[a few
posts](https://www.contino.io/insights/improve-your-security-posture-and-sleep-better-at-night-with-compliance-as-code)
that I've made for [my company](https://contino.io), I've been mostly silent. I
haven't given up on writing; quite the contrary! I haven't run out of neurons to
fire either (darn!). I've stopped writing on my own site for one reason: I
pledged to not write again until I was completely out of WordPress. Now that I
am, I can write again!

# Why do you hate WordPress so much, Carlos?

{{< post_image name="wordpress_sucks.png" alt="WordPress sucks!" >}}

Because principals.

I've been using WordPress for writing blogs since I decided to start writing
back in 2015. (I actually started using it in 2013, but I had commitment
issues.) It's always been a love-hate relationship, mostly erring on the side of
hate, for a few reasons:

- The editor is clunky and takes forever to load over slow connections (this was
  a massive deal in the dark ages when American and Delta were using
  cellular-based internet in their planes and breaking past dial-up speeds was
  a huge surprise.

- The code generated by that editor is all sorts of non-standard.

- I enjoy cross-posting my posts onto LinkedIn Pulse. It was never a copy-paste
  operation, because of the non-standardness mentioned above. It often took
  about an hour to get my WordPress and LinkedIn blog in sync, and even then
  small things weren't perfect.

These were annoying, but not dealbreakers. The deal breaker that finally pushed
me over the edge was this: I had to pay WordPress $13/month to use a custom
domain.

$13/month. "That's really not a lot, Carlos." You're right. But think about it:

- I'm paying them $13/month for what is probably a five-second change on their
  webserver.

- I'm paying them $13/month for the (possible) privilege of using a wildcard SSL
  certificate, so it's not like I'm even telling readers that I own that blog.

- I'm paying them $13/month because _I was too lazy to roll my own solution,
  despite being perfectly capable of doing so_.

It's not the money, here; it's the principle. I'm an Engineer. Why the hell am I
using a chunky, JavaScript-heavy CMS to host my musings when I can use something
lighter?

# The Goal

{{< post_image name="the_goal.png" alt="BlogOps" >}}

This was what I wanted my blog to be:

- Every post to be version-controlled in GitHub.
- Every post is pure, high-grade, unadulterated Markdown.
- The blog would be super fast anywhere and extremely light on JavaScript.
- The blog would have no ads, anywhere, ever.
- The blog can be tested locally and will look and behave the same on the web.
- Adding anything to the blog, including SEO for discoverability, would be easy.
- The blog would be _stupid cheap to run_.
- The blog would be _stupid easy_ to reproduce anywhere, any time.
- The blog will be deployed via CI whenever I post new content.

Essentially, I wanted a fast, super simple blog driven by CI and Git Flow.

# Hello, Hugo

{{< post_image name="hello_hugo.png" alt="The champ of statically generated websites" >}}

I knew that Git-friendly blogs like Ghost existed, but I didn't really know the
landscape well. So I went looking and stumbled upon [Hugo](https://gohugo.io)
within about 32 seconds.

Hugo is a Golang-powered static website generator with a focus on blogs. While
you can create just about any kind of website you put your heart into with it,
it is really good at creating blogs. It's basic premise is three-fold:

- Almost everything is comprised of a hiearchy of HTML files.
- Every post has "front matter" that describes it.
- Everything is configurable through a configuration file (`config.toml` in my case)

Websites powered by Hugo can be hosted by Hugo through a small Go web server or
statically generated and copied onto the web server of your choice.

*Perfect for a WordPress hater like me.*

# Serverless all the things!

{{< post_image name="serverless.png" alt="Why not Serverless" >}}

So my natural inclination was "let's do serverless!"

My thoughts were:

- I don't get a ton of traffic, so why not use Lambda or Azure Functions to
  render the site on demand?
- I get to finally learn serverless and sound cool at talks.

But digging not too deeply into this hole proved that this didn't make any
sense. While I did find a [pretty awesome
guide](https://nickmchardy.com/2018/03/building-a-serverless-cms-using-aws-and-hugo.html) 
on how to do this, it was _way_ more complicated than I originally intended.
Additionally, Hugo _generates static websites_. Just-in-time rendering didn't
make sense when a simple local render and S3 sync would do. While serverless
will probably be much more useful for automated chores (like purging old
`index.html` files since they are versioned; more later), using it for core blog
workloads didn't make sense.



Outline:

- The Problem
  - I ran on WordPress for a while
  - Hated that writing Markdown was harder than it should ever be
  - I'm a developer, dammit; I should be using Git for everything.
  - I'm not paying $13/month for a custom domain with HTTPS.
  - Thus the idea of moving to a statically-generated blog was born!
- The Goals
  - An easily-deployable blog with a custom domain and HTTPS
  - A pipeline for deploying blog posts, complete with unit and integration
    testing
  - A platform that makes search engine discoverability easy.
- Hugo
  - You can host your blog or statically generate it
  - Golang is best lang
  - Free and open source
  - Awesome contribution team
- Serverless idea
  - Quickly shot down
  - Blog is static; serverless is additional overhead
  - I might use serverless for maintenance tasks, though!
- S3
  - Much better solution
  - Easy to sync and easy to host a website out of
  - But I wanted HTTPS; not possible with S3 hosting alone
- CloudFront
  - Didn't really want it, but it does enable HTTPS
  - It also enables super fast access anywhere in NA or Europe
  - Also pretty easy to deploy
- Integration Testing Sucks
  - Takes 20 minutes to turn a distribution up or down
  - No way to test the certificates I create since they are appended to CF
    and not S3
  - Integration testing really ensures that the blog renders on S3 and is
    accessible from the Internet
  - Not ideal, however; I'd like a super small CF distribution for integration
    tests!
- Certificates
  - Started with Let's Encrypt
  - Provisioning was easy with Terraform, but...
    - LE rate-limits certificate provisioning, but the error shown from 
      Terraform is a generic 403
    - This limit applies to both the staging and production ACME repos
    - Configuring staging and production parameters required WAY more
      Terraform code
  - Decided to use AWS ACM certificates instead
    - This makes multi-cloud more difficult
    - But it makes provisioning HTTP on CF easier
- CI
  - Originally wanted to make bloggen for my blog only
  - Decided later on that this might be useful for other people that want
    a cheap, global-scalable Hugo blog on the internet super easily
  - Separating my work into a separate project was difficult
  - Lessons learned
    - Always design as if someone else will use it from the onset
    - Docker in Docker reduces portability, so proceed with caution
    - A CI build system that's easy to test with locally is very, very valuable
- I'm happy
  - Blog is available and easily accessible from my own address
  - I can configure as much or as little SEO as I want
  - No ads, ever
  - BIG: I have full CI for my posts, and they are all in Git!
That's how I ate my own dogfood!
